{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useEffect,useState}from'react';import{ShopAPI}from'./ShopAPIPlugin';import{jsx as _jsx}from\"react/jsx-runtime\";export var DataContext=/*#__PURE__*/React.createContext({});export var DataProvider=function DataProvider(_ref){var children=_ref.children;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),cart=_useState6[0],setCart=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),userPhoto=_useState8[0],setUserPhoto=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),productList=_useState10[0],setProductList=_useState10[1];useEffect(function(){function init(){return _init.apply(this,arguments);}function _init(){_init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,user,cart,photo,products;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsLoading(true);_context.next=3;return Promise.all([getUserDetails(),getCart(),getUserPicture(),getProductList()]);case 3:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,4);user=_yield$Promise$all2[0];cart=_yield$Promise$all2[1];photo=_yield$Promise$all2[2];products=_yield$Promise$all2[3];setUser(user);setCart(cart);setProductList(products);setUserPhoto(photo);setIsLoading(false);case 14:case\"end\":return _context.stop();}}},_callee);}));return _init.apply(this,arguments);}init();},[]);var setUserData=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(user){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsLoading(true);_context2.next=3;return updateUserDetails(user);case 3:setUser(user);setIsLoading(false);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]);var setPhotoData=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(photo){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return setUserPicture(photo);case 2:setUserPhoto(photo);case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}(),[]);return/*#__PURE__*/_jsx(DataContext.Provider,{value:{loading:isLoading,user:user,setUser:setUserData,cart:cart,checkout:checkout,userPhoto:userPhoto,setUserPhoto:setPhotoData,productList:productList},children:children});};function getProductList(){return _getProductList.apply(this,arguments);}function _getProductList(){_getProductList=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var response,data;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return fetch('/data.json');case 2:response=_context4.sent;_context4.next=5;return response.json();case 5:data=_context4.sent;return _context4.abrupt(\"return\",data.products);case 7:case\"end\":return _context4.stop();}}},_callee4);}));return _getProductList.apply(this,arguments);}function getUserDetails(){return _getUserDetails.apply(this,arguments);}function _getUserDetails(){_getUserDetails=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",ShopAPI.getUserDetails());case 1:case\"end\":return _context5.stop();}}},_callee5);}));return _getUserDetails.apply(this,arguments);}function updateUserDetails(_x3){return _updateUserDetails.apply(this,arguments);}function _updateUserDetails(){_updateUserDetails=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(user){return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",ShopAPI.updateUserDetails(user));case 1:case\"end\":return _context6.stop();}}},_callee6);}));return _updateUserDetails.apply(this,arguments);}function getCart(){return _getCart.apply(this,arguments);}function _getCart(){_getCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt(\"return\",ShopAPI.getCart());case 1:case\"end\":return _context7.stop();}}},_callee7);}));return _getCart.apply(this,arguments);}function checkout(_x4){return _checkout.apply(this,arguments);}function _checkout(){_checkout=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(result){return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:ShopAPI.checkoutResult(result);case 1:case\"end\":return _context8.stop();}}},_callee8);}));return _checkout.apply(this,arguments);}function getUserPicture(){return _getUserPicture.apply(this,arguments);}function _getUserPicture(){_getUserPicture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){var userPicture;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return ShopAPI.getUserPicture();case 2:userPicture=_context9.sent;return _context9.abrupt(\"return\",userPicture.picture);case 4:case\"end\":return _context9.stop();}}},_callee9);}));return _getUserPicture.apply(this,arguments);}function setUserPicture(_x5){return _setUserPicture.apply(this,arguments);}function _setUserPicture(){_setUserPicture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(picture){return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return ShopAPI.setUserPicture({picture:picture});case 2:return _context10.abrupt(\"return\",_context10.sent);case 3:case\"end\":return _context10.stop();}}},_callee10);}));return _setUserPicture.apply(this,arguments);}","map":{"version":3,"names":["React","useCallback","useEffect","useState","ShopAPI","DataContext","createContext","DataProvider","children","isLoading","setIsLoading","user","setUser","cart","setCart","userPhoto","setUserPhoto","productList","setProductList","init","Promise","all","getUserDetails","getCart","getUserPicture","getProductList","photo","products","setUserData","updateUserDetails","setPhotoData","setUserPicture","loading","checkout","fetch","response","json","data","result","checkoutResult","userPicture","picture"],"sources":["/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/src/DataProvider.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport {\n  ShopAPI,\n  CheckoutResult,\n  User,\n  Cart,\n  Data,\n  Product,\n} from './ShopAPIPlugin';\n\nexport interface DataState {\n  loading: boolean;\n  user?: User;\n  setUser: (user: User) => void;\n  cart?: Cart;\n  checkout: (result: CheckoutResult) => void;\n  userPhoto?: string;\n  setUserPhoto: (photo: string) => void;\n  productList: Product[];\n}\n\nexport const DataContext = React.createContext<DataState>({} as any);\n\nexport const DataProvider: React.FC = ({ children }) => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [user, setUser] = useState<User>();\n  const [cart, setCart] = useState<Cart>();\n  const [userPhoto, setUserPhoto] = useState<string>();\n  const [productList, setProductList] = useState<Product[]>([]);\n\n  useEffect(() => {\n    async function init() {\n      setIsLoading(true);\n      const [user, cart, photo, products] = await Promise.all([\n        getUserDetails(),\n        getCart(),\n        getUserPicture(),\n        getProductList(),\n      ]);\n      setUser(user);\n      setCart(cart);\n      setProductList(products);\n      setUserPhoto(photo);\n      setIsLoading(false);\n    }\n    init();\n  }, []);\n\n  const setUserData = useCallback(async (user: User) => {\n    setIsLoading(true);\n    await updateUserDetails(user);\n    setUser(user);\n    setIsLoading(false);\n  }, []);\n\n  const setPhotoData = useCallback(async (photo: string) => {\n    await setUserPicture(photo);\n    setUserPhoto(photo);\n  }, []);\n\n  return (\n    <DataContext.Provider\n      value={{\n        loading: isLoading,\n        user,\n        setUser: setUserData,\n        cart,\n        checkout: checkout,\n        userPhoto,\n        setUserPhoto: setPhotoData,\n        productList,\n      }}\n    >\n      {children}\n    </DataContext.Provider>\n  );\n};\n\nasync function getProductList(): Promise<Product[]> {\n  const response = await fetch('/data.json');\n  const data = (await response.json()) as Data;\n  return data.products;\n}\n\nasync function getUserDetails(): Promise<User> {\n  return ShopAPI.getUserDetails();\n}\n\nasync function updateUserDetails(user: User): Promise<void> {\n  return ShopAPI.updateUserDetails(user);\n}\n\nasync function getCart(): Promise<Cart> {\n  return ShopAPI.getCart();\n}\n\nasync function checkout(result: CheckoutResult) {\n  ShopAPI.checkoutResult(result);\n}\n\nasync function getUserPicture() {\n  const userPicture = await ShopAPI.getUserPicture();\n  return userPicture.picture;\n}\n\nasync function setUserPicture(picture: string) {\n  return await ShopAPI.setUserPicture({ picture });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}