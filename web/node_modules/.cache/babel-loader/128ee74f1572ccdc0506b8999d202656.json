{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{IonButton,IonContent,IonHeader,IonIcon,IonInput,IonItem,IonLabel,IonList,IonListHeader,IonPage,IonTitle,IonToolbar,useIonRouter,useIonModal}from'@ionic/react';import{useCallback,useContext,useEffect,useState}from'react';import{DataContext}from'../../DataProvider';import{add}from'ionicons/icons';import{Camera,CameraDirection,CameraResultType}from'@capacitor/camera';import'./UserDetailPage.scss';import AddressItem from'../../components/AddressItem';import PaymentItem from'../../components/PaymentItem';import ImageCropper from'../../components/ImageCropper';import FadeIn from'../../components/FadeIn';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var UserDetailPage=function UserDetailPage(){var _useContext=useContext(DataContext),user=_useContext.user,setUser=_useContext.setUser,userPhoto=_useContext.userPhoto,setUserPhoto=_useContext.setUserPhoto;var _useState=useState(),_useState2=_slicedToArray(_useState,2),formData=_useState2[0],setFormData=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),cameraImage=_useState4[0],setCameraImage=_useState4[1];var router=useIonRouter();var handleCropComplete=function handleCropComplete(dataImageUrl){setUserPhoto(dataImageUrl);setCameraImage(undefined);hideCropModal();};var _useIonModal=useIonModal(/*#__PURE__*/_jsx(ImageCropper,{image:cameraImage,onCropComplete:handleCropComplete,closeModal:function closeModal(){return hideCropModal();}})),_useIonModal2=_slicedToArray(_useIonModal,2),showCropModal=_useIonModal2[0],hideCropModal=_useIonModal2[1];useEffect(function(){if(user&&userPhoto&&!formData){setFormData({firstName:user.firstName,lastName:user.lastName,email:user.email});}},[formData,user,userPhoto]);var updateUser=useCallback(function(){if(user&&formData){setUser(_objectSpread(_objectSpread({},user),formData));}},[user,formData,setUser]);var handlePictureClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var image;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takePicture();case 2:image=_context.sent;setCameraImage(image);showCropModal();case 5:case\"end\":return _context.stop();}}},_callee);}));return function handlePictureClick(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(IonPage,{id:\"user-detail-page\",children:[/*#__PURE__*/_jsx(IonHeader,{children:/*#__PURE__*/_jsx(IonToolbar,{children:/*#__PURE__*/_jsx(IonTitle,{children:\"Profile\"})})}),/*#__PURE__*/_jsx(FadeIn,{isLoaded:user!=null&&formData!=null,children:/*#__PURE__*/_jsxs(IonContent,{children:[/*#__PURE__*/_jsx(IonHeader,{collapse:\"condense\",children:/*#__PURE__*/_jsx(IonToolbar,{children:/*#__PURE__*/_jsx(IonTitle,{size:\"large\",children:\"Profile\"})})}),user&&formData&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-image\",onClick:handlePictureClick,children:[/*#__PURE__*/_jsx(\"img\",{src:userPhoto,alt:\"\".concat(user.firstName,\" \").concat(user.lastName)}),/*#__PURE__*/_jsx(IonIcon,{icon:add})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsxs(IonList,{lines:\"full\",children:[/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{children:\"First name\"}),/*#__PURE__*/_jsx(IonInput,{value:formData.firstName,onIonChange:function onIonChange(e){var value=e.detail.value;if(value){setFormData(_objectSpread(_objectSpread({},formData),{},{firstName:value}));}},onBlur:updateUser})]}),/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{children:\"Last name\"}),/*#__PURE__*/_jsx(IonInput,{value:formData.lastName,onIonChange:function onIonChange(e){var value=e.detail.value;if(value){setFormData(_objectSpread(_objectSpread({},formData),{},{lastName:value}));}},onBlur:updateUser})]}),/*#__PURE__*/_jsxs(IonItem,{children:[/*#__PURE__*/_jsx(IonLabel,{children:\"Email Address\"}),/*#__PURE__*/_jsx(IonInput,{value:formData.email,onIonChange:function onIonChange(e){setFormData(_objectSpread(_objectSpread({},formData),{},{email:e.detail.value}));},onBlur:updateUser})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"list-section\",children:[/*#__PURE__*/_jsxs(IonList,{lines:\"none\",children:[/*#__PURE__*/_jsx(IonListHeader,{children:\"Addresses\"}),user.addresses.map(function(address){return/*#__PURE__*/_jsx(AddressItem,{address:address,selectable:false,user:user},address.id);})]}),/*#__PURE__*/_jsx(IonButton,{expand:\"block\",color:\"secondary\",onClick:function onClick(){return router.push('/address');},children:\"New Address\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"list-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Payment Methods\"}),/*#__PURE__*/_jsx(IonList,{lines:\"none\",children:user.creditCards.map(function(creditCard){return/*#__PURE__*/_jsx(PaymentItem,{creditCard:creditCard,selectable:false},creditCard.id);})}),/*#__PURE__*/_jsx(IonButton,{expand:\"block\",color:\"secondary\",onClick:function onClick(){return router.push('/payment');},children:\"New Payment Method\"})]})]})]})})]});};function takePicture(){return _takePicture.apply(this,arguments);}function _takePicture(){_takePicture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var image;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Camera.getPhoto({quality:100,width:300,direction:CameraDirection.Front,resultType:CameraResultType.Uri});case 2:image=_context2.sent;return _context2.abrupt(\"return\",image.webPath);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _takePicture.apply(this,arguments);}export default UserDetailPage;","map":{"version":3,"names":["IonButton","IonContent","IonHeader","IonIcon","IonInput","IonItem","IonLabel","IonList","IonListHeader","IonPage","IonTitle","IonToolbar","useIonRouter","useIonModal","useCallback","useContext","useEffect","useState","DataContext","add","Camera","CameraDirection","CameraResultType","AddressItem","PaymentItem","ImageCropper","FadeIn","UserDetailPage","user","setUser","userPhoto","setUserPhoto","formData","setFormData","cameraImage","setCameraImage","router","handleCropComplete","dataImageUrl","undefined","hideCropModal","showCropModal","firstName","lastName","email","updateUser","handlePictureClick","takePicture","image","e","value","detail","addresses","map","address","id","push","creditCards","creditCard","getPhoto","quality","width","direction","Front","resultType","Uri","webPath"],"sources":["/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/src/pages/UserDetailPage/UserDetailPage.tsx"],"sourcesContent":["import {\n  IonButton,\n  IonContent,\n  IonHeader,\n  IonIcon,\n  IonInput,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonListHeader,\n  IonPage,\n  IonTitle,\n  IonToolbar,\n  useIonRouter,\n  useIonModal,\n} from '@ionic/react';\nimport { useCallback, useContext, useEffect, useState } from 'react';\nimport { DataContext } from '../../DataProvider';\nimport { add } from 'ionicons/icons';\nimport { Camera, CameraDirection, CameraResultType } from '@capacitor/camera';\nimport './UserDetailPage.scss';\nimport AddressItem from '../../components/AddressItem';\nimport PaymentItem from '../../components/PaymentItem';\nimport ImageCropper from '../../components/ImageCropper';\nimport FadeIn from '../../components/FadeIn';\n\ninterface FormData {\n  firstName: string;\n  lastName: string;\n  email: string;\n}\n\nconst UserDetailPage = () => {\n  const { user, setUser, userPhoto, setUserPhoto } = useContext(DataContext);\n  const [formData, setFormData] = useState<FormData>();\n  const [cameraImage, setCameraImage] = useState<string>();\n  const router = useIonRouter();\n\n  const handleCropComplete = (dataImageUrl: string) => {\n    setUserPhoto(dataImageUrl);\n    setCameraImage(undefined);\n    hideCropModal();\n  };\n\n  const [showCropModal, hideCropModal] = useIonModal(\n    <ImageCropper\n      image={cameraImage!}\n      onCropComplete={handleCropComplete}\n      closeModal={() => hideCropModal()}\n    />,\n  );\n\n  useEffect(() => {\n    if (user && userPhoto && !formData) {\n      setFormData({\n        firstName: user.firstName,\n        lastName: user.lastName,\n        email: user.email,\n      });\n    }\n  }, [formData, user, userPhoto]);\n\n  const updateUser = useCallback(() => {\n    if (user && formData) {\n      setUser({ ...user, ...formData });\n    }\n  }, [user, formData, setUser]);\n\n  const handlePictureClick = async () => {\n    const image = await takePicture();\n    setCameraImage(image);\n    showCropModal();\n  };\n\n  return (\n    <IonPage id=\"user-detail-page\">\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle>Profile</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <FadeIn isLoaded={user != null && formData != null}>\n        <IonContent>\n          <IonHeader collapse=\"condense\">\n            <IonToolbar>\n              <IonTitle size=\"large\">Profile</IonTitle>\n            </IonToolbar>\n          </IonHeader>\n          {user && formData && (\n            <>\n              <div className=\"user-image\" onClick={handlePictureClick}>\n                <img\n                  src={userPhoto}\n                  alt={`${user.firstName} ${user.lastName}`}\n                />\n                <IonIcon icon={add} />\n              </div>\n              <div className=\"user-info\">\n                <IonList lines=\"full\">\n                  <IonItem>\n                    <IonLabel>First name</IonLabel>\n                    <IonInput\n                      value={formData.firstName}\n                      onIonChange={(e) => {\n                        const value = e.detail.value!;\n                        if (value) {\n                          setFormData({ ...formData, firstName: value });\n                        }\n                      }}\n                      onBlur={updateUser}\n                    ></IonInput>\n                  </IonItem>\n                  <IonItem>\n                    <IonLabel>Last name</IonLabel>\n                    <IonInput\n                      value={formData.lastName}\n                      onIonChange={(e) => {\n                        const value = e.detail.value!;\n                        if (value) {\n                          setFormData({ ...formData, lastName: value });\n                        }\n                      }}\n                      onBlur={updateUser}\n                    ></IonInput>\n                  </IonItem>\n                  <IonItem>\n                    <IonLabel>Email Address</IonLabel>\n                    <IonInput\n                      value={formData.email}\n                      onIonChange={(e) => {\n                        setFormData({ ...formData, email: e.detail.value! });\n                      }}\n                      onBlur={updateUser}\n                    ></IonInput>\n                  </IonItem>\n                </IonList>\n\n                <div className=\"list-section\">\n                  <IonList lines=\"none\">\n                    <IonListHeader>Addresses</IonListHeader>\n                    {user.addresses.map((address) => (\n                      <AddressItem\n                        key={address.id}\n                        address={address}\n                        selectable={false}\n                        user={user}\n                      />\n                    ))}\n                  </IonList>\n                  <IonButton\n                    expand=\"block\"\n                    color=\"secondary\"\n                    onClick={() => router.push('/address')}\n                  >\n                    New Address\n                  </IonButton>\n                </div>\n              </div>\n\n              <div className=\"list-section\">\n                <h4>Payment Methods</h4>\n                <IonList lines=\"none\">\n                  {user.creditCards.map((creditCard) => (\n                    <PaymentItem\n                      key={creditCard.id}\n                      creditCard={creditCard}\n                      selectable={false}\n                    />\n                  ))}\n                </IonList>\n                <IonButton\n                  expand=\"block\"\n                  color=\"secondary\"\n                  onClick={() => router.push('/payment')}\n                >\n                  New Payment Method\n                </IonButton>\n              </div>\n            </>\n          )}\n        </IonContent>\n      </FadeIn>\n    </IonPage>\n  );\n};\n\nasync function takePicture() {\n  const image = await Camera.getPhoto({\n    quality: 100,\n    width: 300,\n    direction: CameraDirection.Front,\n    resultType: CameraResultType.Uri,\n  });\n  return image.webPath;\n}\n\nexport default UserDetailPage;\n"],"mappings":"2kBAAA,OACEA,SAAS,CACTC,UAAU,CACVC,SAAS,CACTC,OAAO,CACPC,QAAQ,CACRC,OAAO,CACPC,QAAQ,CACRC,OAAO,CACPC,aAAa,CACbC,OAAO,CACPC,QAAQ,CACRC,UAAU,CACVC,YAAY,CACZC,WAAW,KACN,cAAc,CACrB,OAASC,WAAW,CAAEC,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CACpE,OAASC,WAAW,KAAQ,oBAAoB,CAChD,OAASC,GAAG,KAAQ,gBAAgB,CACpC,OAASC,MAAM,CAAEC,eAAe,CAAEC,gBAAgB,KAAQ,mBAAmB,CAC7E,MAAO,uBAAuB,CAC9B,MAAOC,YAAW,KAAM,8BAA8B,CACtD,MAAOC,YAAW,KAAM,8BAA8B,CACtD,MAAOC,aAAY,KAAM,+BAA+B,CACxD,MAAOC,OAAM,KAAM,yBAAyB,CAAC,6IAQ7C,GAAMC,eAAc,CAAG,QAAjBA,eAAc,EAAS,CAC3B,gBAAmDZ,UAAU,CAACG,WAAW,CAAC,CAAlEU,IAAI,aAAJA,IAAI,CAAEC,OAAO,aAAPA,OAAO,CAAEC,SAAS,aAATA,SAAS,CAAEC,YAAY,aAAZA,YAAY,CAC9C,cAAgCd,QAAQ,EAAY,wCAA7Ce,QAAQ,eAAEC,WAAW,eAC5B,eAAsChB,QAAQ,EAAU,yCAAjDiB,WAAW,eAAEC,cAAc,eAClC,GAAMC,OAAM,CAAGxB,YAAY,EAAE,CAE7B,GAAMyB,mBAAkB,CAAG,QAArBA,mBAAkB,CAAIC,YAAoB,CAAK,CACnDP,YAAY,CAACO,YAAY,CAAC,CAC1BH,cAAc,CAACI,SAAS,CAAC,CACzBC,aAAa,EAAE,CACjB,CAAC,CAED,iBAAuC3B,WAAW,cAChD,KAAC,YAAY,EACX,KAAK,CAAEqB,WAAa,CACpB,cAAc,CAAEG,kBAAmB,CACnC,UAAU,CAAE,4BAAMG,cAAa,EAAE,EAAC,EAClC,CACH,8CANMC,aAAa,kBAAED,aAAa,kBAQnCxB,SAAS,CAAC,UAAM,CACd,GAAIY,IAAI,EAAIE,SAAS,EAAI,CAACE,QAAQ,CAAE,CAClCC,WAAW,CAAC,CACVS,SAAS,CAAEd,IAAI,CAACc,SAAS,CACzBC,QAAQ,CAAEf,IAAI,CAACe,QAAQ,CACvBC,KAAK,CAAEhB,IAAI,CAACgB,KACd,CAAC,CAAC,CACJ,CACF,CAAC,CAAE,CAACZ,QAAQ,CAAEJ,IAAI,CAAEE,SAAS,CAAC,CAAC,CAE/B,GAAMe,WAAU,CAAG/B,WAAW,CAAC,UAAM,CACnC,GAAIc,IAAI,EAAII,QAAQ,CAAE,CACpBH,OAAO,gCAAMD,IAAI,EAAKI,QAAQ,EAAG,CACnC,CACF,CAAC,CAAE,CAACJ,IAAI,CAAEI,QAAQ,CAAEH,OAAO,CAAC,CAAC,CAE7B,GAAMiB,mBAAkB,4FAAG,qKACLC,YAAW,EAAE,QAA3BC,KAAK,eACXb,cAAc,CAACa,KAAK,CAAC,CACrBP,aAAa,EAAE,CAAC,sDACjB,kBAJKK,mBAAkB,0CAIvB,CAED,mBACE,MAAC,OAAO,EAAC,EAAE,CAAC,kBAAkB,wBAC5B,KAAC,SAAS,wBACR,KAAC,UAAU,wBACT,KAAC,QAAQ,sBAAmB,EACjB,EACH,cACZ,KAAC,MAAM,EAAC,QAAQ,CAAElB,IAAI,EAAI,IAAI,EAAII,QAAQ,EAAI,IAAK,uBACjD,MAAC,UAAU,yBACT,KAAC,SAAS,EAAC,QAAQ,CAAC,UAAU,uBAC5B,KAAC,UAAU,wBACT,KAAC,QAAQ,EAAC,IAAI,CAAC,OAAO,qBAAmB,EAC9B,EACH,CACXJ,IAAI,EAAII,QAAQ,eACf,wCACE,aAAK,SAAS,CAAC,YAAY,CAAC,OAAO,CAAEc,kBAAmB,wBACtD,YACE,GAAG,CAAEhB,SAAU,CACf,GAAG,WAAKF,IAAI,CAACc,SAAS,aAAId,IAAI,CAACe,QAAQ,CAAG,EAC1C,cACF,KAAC,OAAO,EAAC,IAAI,CAAExB,GAAI,EAAG,GAClB,cACN,aAAK,SAAS,CAAC,WAAW,wBACxB,MAAC,OAAO,EAAC,KAAK,CAAC,MAAM,wBACnB,MAAC,OAAO,yBACN,KAAC,QAAQ,yBAAsB,cAC/B,KAAC,QAAQ,EACP,KAAK,CAAEa,QAAQ,CAACU,SAAU,CAC1B,WAAW,CAAE,qBAACO,CAAC,CAAK,CAClB,GAAMC,MAAK,CAAGD,CAAC,CAACE,MAAM,CAACD,KAAM,CAC7B,GAAIA,KAAK,CAAE,CACTjB,WAAW,gCAAMD,QAAQ,MAAEU,SAAS,CAAEQ,KAAK,GAAG,CAChD,CACF,CAAE,CACF,MAAM,CAAEL,UAAW,EACT,GACJ,cACV,MAAC,OAAO,yBACN,KAAC,QAAQ,wBAAqB,cAC9B,KAAC,QAAQ,EACP,KAAK,CAAEb,QAAQ,CAACW,QAAS,CACzB,WAAW,CAAE,qBAACM,CAAC,CAAK,CAClB,GAAMC,MAAK,CAAGD,CAAC,CAACE,MAAM,CAACD,KAAM,CAC7B,GAAIA,KAAK,CAAE,CACTjB,WAAW,gCAAMD,QAAQ,MAAEW,QAAQ,CAAEO,KAAK,GAAG,CAC/C,CACF,CAAE,CACF,MAAM,CAAEL,UAAW,EACT,GACJ,cACV,MAAC,OAAO,yBACN,KAAC,QAAQ,4BAAyB,cAClC,KAAC,QAAQ,EACP,KAAK,CAAEb,QAAQ,CAACY,KAAM,CACtB,WAAW,CAAE,qBAACK,CAAC,CAAK,CAClBhB,WAAW,gCAAMD,QAAQ,MAAEY,KAAK,CAAEK,CAAC,CAACE,MAAM,CAACD,KAAM,GAAG,CACtD,CAAE,CACF,MAAM,CAAEL,UAAW,EACT,GACJ,GACF,cAEV,aAAK,SAAS,CAAC,cAAc,wBAC3B,MAAC,OAAO,EAAC,KAAK,CAAC,MAAM,wBACnB,KAAC,aAAa,wBAA0B,CACvCjB,IAAI,CAACwB,SAAS,CAACC,GAAG,CAAC,SAACC,OAAO,qBAC1B,KAAC,WAAW,EAEV,OAAO,CAAEA,OAAQ,CACjB,UAAU,CAAE,KAAM,CAClB,IAAI,CAAE1B,IAAK,EAHN0B,OAAO,CAACC,EAAE,CAIf,EACH,CAAC,GACM,cACV,KAAC,SAAS,EACR,MAAM,CAAC,OAAO,CACd,KAAK,CAAC,WAAW,CACjB,OAAO,CAAE,yBAAMnB,OAAM,CAACoB,IAAI,CAAC,UAAU,CAAC,EAAC,yBAG7B,GACR,GACF,cAEN,aAAK,SAAS,CAAC,cAAc,wBAC3B,uCAAwB,cACxB,KAAC,OAAO,EAAC,KAAK,CAAC,MAAM,UAClB5B,IAAI,CAAC6B,WAAW,CAACJ,GAAG,CAAC,SAACK,UAAU,qBAC/B,KAAC,WAAW,EAEV,UAAU,CAAEA,UAAW,CACvB,UAAU,CAAE,KAAM,EAFbA,UAAU,CAACH,EAAE,CAGlB,EACH,CAAC,EACM,cACV,KAAC,SAAS,EACR,MAAM,CAAC,OAAO,CACd,KAAK,CAAC,WAAW,CACjB,OAAO,CAAE,yBAAMnB,OAAM,CAACoB,IAAI,CAAC,UAAU,CAAC,EAAC,gCAG7B,GACR,GAET,GACU,EACN,GACD,CAEd,CAAC,CAAC,QAEaT,YAAW,6IAA1B,2KACsB3B,OAAM,CAACuC,QAAQ,CAAC,CAClCC,OAAO,CAAE,GAAG,CACZC,KAAK,CAAE,GAAG,CACVC,SAAS,CAAEzC,eAAe,CAAC0C,KAAK,CAChCC,UAAU,CAAE1C,gBAAgB,CAAC2C,GAC/B,CAAC,CAAC,QALIjB,KAAK,iDAMJA,KAAK,CAACkB,OAAO,0DACrB,8CAED,cAAevC,eAAc"},"metadata":{},"sourceType":"module"}