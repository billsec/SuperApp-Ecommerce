{"ast":null,"code":"import _toConsumableArray from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useState}from'react';import{caretDownOutline}from'ionicons/icons';import{IonItem,IonLabel,IonInput,IonHeader,IonButtons,IonBackButton,IonToolbar,IonTitle,IonButton,IonContent,IonPage,IonIcon,IonCheckbox,IonText,useIonPicker,useIonRouter}from'@ionic/react';import{DataContext}from'../../DataProvider';import{stateCodes}from'../../util/states';import'./AddressPage.css';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var AddressPage=function AddressPage(props){var id=props.match.params.id;var _useContext=useContext(DataContext),user=_useContext.user,setUser=_useContext.setUser;var _useState=useState(),_useState2=_slicedToArray(_useState,2),address=_useState2[0],setAddress=_useState2[1];var _useIonPicker=useIonPicker(),_useIonPicker2=_slicedToArray(_useIonPicker,1),present=_useIonPicker2[0];var router=useIonRouter();useEffect(function(){if(user){if(id){var a=user.addresses.find(function(x){return x.id===Number(id);});setAddress(a);}else{setAddress({id:0,city:'',postal:'',state:'',street:'',preferred:false});}}},[id,user]);var pickStateCode=function pickStateCode(){present({buttons:[{text:'Confirm',handler:function handler(selected){if(address){setAddress(_objectSpread(_objectSpread({},address),{},{state:selected.StateCode.value}));}}}],columns:[{name:'StateCode',options:stateCodes.map(function(code){return{text:code,value:code};}),selectedIndex:stateCodes.findIndex(function(x){return x===(address===null||address===void 0?void 0:address.state);})}]});};var handleSave=function handleSave(){if(user&&address){var newUser;if(address.id===0){address.id=(user.addresses.length>0?Math.max.apply(Math,_toConsumableArray(user.addresses.map(function(x){return x.id;}))):0)+1;newUser=_objectSpread(_objectSpread({},user),{},{addresses:[].concat(_toConsumableArray(user.addresses),[address])});}else{newUser=_objectSpread(_objectSpread({},user),{},{addresses:_toConsumableArray(user.addresses.map(function(x){return x.id===address.id?address:x;}))});}if(address.preferred){newUser.addresses.forEach(function(x){if(x.id!==address.id){x.preferred=false;}});}setUser(newUser);if(router.canGoBack()){router.goBack();}}};return user&&address?/*#__PURE__*/_jsxs(IonPage,{children:[/*#__PURE__*/_jsx(IonHeader,{children:/*#__PURE__*/_jsxs(IonToolbar,{children:[/*#__PURE__*/_jsxs(IonTitle,{children:[address.id===0?'Add':'Edit',\" Address\"]}),/*#__PURE__*/_jsx(IonButtons,{slot:\"start\",children:/*#__PURE__*/_jsx(IonBackButton,{text:\"Cancel\"})})]})}),/*#__PURE__*/_jsxs(IonContent,{children:[/*#__PURE__*/_jsxs(IonItem,{lines:\"full\",children:[/*#__PURE__*/_jsx(IonLabel,{position:\"fixed\",children:\"Full Name\"}),/*#__PURE__*/_jsx(IonInput,{placeholder:\"\",disabled:true,value:\"\".concat(user===null||user===void 0?void 0:user.firstName,\" \").concat(user===null||user===void 0?void 0:user.lastName).trim()})]}),/*#__PURE__*/_jsxs(IonItem,{lines:\"full\",children:[/*#__PURE__*/_jsx(IonLabel,{position:\"fixed\",children:\"Address\"}),/*#__PURE__*/_jsx(IonInput,{placeholder:\"\",debounce:500,onIonChange:function onIonChange(event){setAddress(_objectSpread(_objectSpread({},address),{},{street:event.detail.value}));},value:address.street})]}),/*#__PURE__*/_jsxs(IonItem,{lines:\"full\",children:[/*#__PURE__*/_jsx(IonLabel,{position:\"fixed\",children:\"Zip Code\"}),/*#__PURE__*/_jsx(IonInput,{placeholder:\"\",type:\"number\",pattern:\"[0-9]*\",debounce:500,onIonChange:function onIonChange(event){setAddress(_objectSpread(_objectSpread({},address),{},{postal:event.detail.value}));},value:address.postal})]}),/*#__PURE__*/_jsxs(IonItem,{lines:\"full\",children:[/*#__PURE__*/_jsx(IonLabel,{position:\"fixed\",children:\"City\"}),/*#__PURE__*/_jsx(IonInput,{placeholder:\"\",debounce:500,onIonChange:function onIonChange(event){setAddress(_objectSpread(_objectSpread({},address),{},{city:event.detail.value}));},value:address.city})]}),/*#__PURE__*/_jsxs(IonItem,{lines:\"full\",children:[/*#__PURE__*/_jsx(IonLabel,{position:\"fixed\",children:\"State\"}),/*#__PURE__*/_jsx(IonInput,{placeholder:\"\",onClick:pickStateCode,value:address.state}),/*#__PURE__*/_jsx(IonButton,{color:\"light\",fill:\"clear\",expand:\"block\",onClick:pickStateCode,children:/*#__PURE__*/_jsx(IonIcon,{slot:\"icon-only\",icon:caretDownOutline})})]}),/*#__PURE__*/_jsxs(IonItem,{lines:\"none\",children:[/*#__PURE__*/_jsx(IonCheckbox,{checked:address.preferred,onIonChange:function onIonChange(e){setAddress(_objectSpread(_objectSpread({},address),{},{preferred:!address.preferred}));}}),/*#__PURE__*/_jsx(IonText,{children:\"Set as default address\"})]}),/*#__PURE__*/_jsx(IonButton,{expand:\"block\",onClick:handleSave,children:\"Save\"})]})]}):null;};export default AddressPage;","map":{"version":3,"names":["React","useContext","useEffect","useState","caretDownOutline","IonItem","IonLabel","IonInput","IonHeader","IonButtons","IonBackButton","IonToolbar","IonTitle","IonButton","IonContent","IonPage","IonIcon","IonCheckbox","IonText","useIonPicker","useIonRouter","DataContext","stateCodes","AddressPage","props","id","match","params","user","setUser","address","setAddress","present","router","a","addresses","find","x","Number","city","postal","state","street","preferred","pickStateCode","buttons","text","handler","selected","StateCode","value","columns","name","options","map","code","selectedIndex","findIndex","handleSave","newUser","length","Math","max","forEach","canGoBack","goBack","firstName","lastName","trim","event","detail","e"],"sources":["/Users/jiayingsu/Projects/portals-ecommerce-demo-main/web/src/pages/AddressPage/AddressPage.tsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { caretDownOutline } from 'ionicons/icons';\nimport {\n  IonItem,\n  IonLabel,\n  IonInput,\n  IonHeader,\n  IonButtons,\n  IonBackButton,\n  IonToolbar,\n  IonTitle,\n  IonButton,\n  IonContent,\n  IonPage,\n  IonIcon,\n  IonCheckbox,\n  IonText,\n  useIonPicker,\n  useIonRouter,\n} from '@ionic/react';\nimport { DataContext } from '../../DataProvider';\nimport { stateCodes } from '../../util/states';\nimport './AddressPage.css';\nimport { RouteComponentProps } from 'react-router';\nimport { Address, User } from '../../ShopAPIPlugin';\n\ntype AddressPageProps = {\n  id: string;\n};\n\nconst AddressPage: React.FC<RouteComponentProps<AddressPageProps>> = (\n  props\n) => {\n  const { id } = props.match.params;\n  const { user, setUser } = useContext(DataContext);\n  const [address, setAddress] = useState<Address>();\n  const [present] = useIonPicker();\n  const router = useIonRouter();\n\n  useEffect(() => {\n    if (user) {\n      if (id) {\n        const a = user.addresses.find((x) => x.id === Number(id));\n        setAddress(a);\n      } else {\n        setAddress({\n          id: 0,\n          city: '',\n          postal: '',\n          state: '',\n          street: '',\n          preferred: false,\n        });\n      }\n    }\n  }, [id, user]);\n\n  const pickStateCode = () => {\n    present({\n      buttons: [\n        {\n          text: 'Confirm',\n          handler: (selected) => {\n            if (address) {\n              setAddress({ ...address, state: selected.StateCode.value });\n            }\n          },\n        },\n      ],\n      columns: [\n        {\n          name: 'StateCode',\n          options: stateCodes.map((code) => {\n            return { text: code, value: code };\n          }),\n          selectedIndex: stateCodes.findIndex((x) => x === address?.state),\n        },\n      ],\n    });\n  };\n\n  const handleSave = () => {\n    if (user && address) {\n      let newUser: User;\n      if (address.id === 0) {\n        address.id =\n          (user.addresses.length > 0\n            ? Math.max(...user.addresses.map((x) => x.id))\n            : 0) + 1;\n        newUser = {\n          ...user,\n          addresses: [...user.addresses, address],\n        };\n      } else {\n        newUser = {\n          ...user,\n          addresses: [\n            ...user.addresses.map((x) => (x.id === address.id ? address : x)),\n          ],\n        };\n      }\n      if (address.preferred) {\n        newUser.addresses.forEach((x) => {\n          if (x.id !== address.id) {\n            x.preferred = false;\n          }\n        });\n      }\n      setUser(newUser);\n      if (router.canGoBack()) {\n        router.goBack();\n      }\n    }\n  };\n\n  return user && address ? (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonTitle>{address.id === 0 ? 'Add' : 'Edit'} Address</IonTitle>\n          <IonButtons slot=\"start\">\n            <IonBackButton text=\"Cancel\" />\n          </IonButtons>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <IonItem lines=\"full\">\n          <IonLabel position=\"fixed\">Full Name</IonLabel>\n          <IonInput\n            placeholder=\"\"\n            disabled\n            value={`${user?.firstName} ${user?.lastName}`.trim()}\n          ></IonInput>\n        </IonItem>\n        <IonItem lines=\"full\">\n          <IonLabel position=\"fixed\">Address</IonLabel>\n          <IonInput\n            placeholder=\"\"\n            debounce={500}\n            onIonChange={(event) => {\n              setAddress({ ...address, street: event.detail.value! });\n            }}\n            value={address.street}\n          ></IonInput>\n        </IonItem>\n        <IonItem lines=\"full\">\n          <IonLabel position=\"fixed\">Zip Code</IonLabel>\n          <IonInput\n            placeholder=\"\"\n            type=\"number\"\n            pattern=\"[0-9]*\"\n            debounce={500}\n            onIonChange={(event) => {\n              setAddress({ ...address, postal: event.detail.value! });\n            }}\n            value={address.postal}\n          ></IonInput>\n        </IonItem>\n        <IonItem lines=\"full\">\n          <IonLabel position=\"fixed\">City</IonLabel>\n          <IonInput\n            placeholder=\"\"\n            debounce={500}\n            onIonChange={(event) => {\n              setAddress({ ...address, city: event.detail.value! });\n            }}\n            value={address.city}\n          ></IonInput>\n        </IonItem>\n        <IonItem lines=\"full\">\n          <IonLabel position=\"fixed\">State</IonLabel>\n          <IonInput\n            placeholder=\"\"\n            onClick={pickStateCode}\n            value={address.state}\n          ></IonInput>\n          {/* TODO: Style this to fit design better */}\n          <IonButton\n            color=\"light\"\n            fill=\"clear\"\n            expand=\"block\"\n            onClick={pickStateCode}\n          >\n            <IonIcon slot=\"icon-only\" icon={caretDownOutline} />\n          </IonButton>\n        </IonItem>\n        <IonItem lines=\"none\">\n          <IonCheckbox\n            checked={address.preferred}\n            onIonChange={(e) => {\n              setAddress({ ...address, preferred: !address.preferred });\n            }}\n          />\n          <IonText>Set as default address</IonText>\n        </IonItem>\n        <IonButton expand=\"block\" onClick={handleSave}>\n          Save\n        </IonButton>\n      </IonContent>\n    </IonPage>\n  ) : null;\n};\n\nexport default AddressPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}